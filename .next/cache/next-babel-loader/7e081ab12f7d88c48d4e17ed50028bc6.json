{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useEffect } from \"react\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport { Card, CardContent, Typography, Link } from \"@material-ui/core\";\nimport StarRatings from \"react-star-ratings\";\nimport { commonStyles, desktopStyles, mobileStyles, TabStyles } from \"./styles\";\nimport moment from \"moment\";\nimport BorderColorIcon from \"@material-ui/icons/BorderColor\";\nimport MoreVertIcon from \"@material-ui/icons/MoreVert\";\nimport Button from \"@material-ui/core/Button\";\nimport Menu from \"@material-ui/core/Menu\";\nimport MenuItem from \"@material-ui/core/MenuItem\";\nimport Snackbar from \"@material-ui/core/Snackbar\";\nimport MuiAlert from \"@material-ui/lab/Alert\";\nimport { DeleteProduct, Favourite } from \"../../apis/auth-api\";\nimport { authenticated } from \"../../redux/actions/auth\";\nimport { useRouter } from \"next/router\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport FavoriteIcon from \"@material-ui/icons/Favorite\";\nimport FavoriteBorderIcon from \"@material-ui/icons/FavoriteBorder\";\nvar API_HOST = process.env.API_HOST;\n\nfunction Alert(props) {\n  return __jsx(MuiAlert, _extends({\n    elevation: 6,\n    variant: \"filled\"\n  }, props));\n}\n\nvar useStyles = makeStyles(function (theme) {\n  var _objectSpread2;\n\n  return _objectSpread(_objectSpread({}, commonStyles), {}, (_objectSpread2 = {}, _defineProperty(_objectSpread2, theme.breakpoints.up(\"sm\"), desktopStyles), _defineProperty(_objectSpread2, theme.breakpoints.between(\"xs\", \"sm\"), TabStyles), _defineProperty(_objectSpread2, theme.breakpoints.down(\"xs\"), mobileStyles), _objectSpread2));\n});\n\nfunction ProductCard(_ref) {\n  var data = _ref.data,\n      _ref$isAuthUser = _ref.isAuthUser,\n      isAuthUser = _ref$isAuthUser === void 0 ? false : _ref$isAuthUser;\n  var dispatch = useDispatch();\n\n  var _React$useState = React.useState(data.saved),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      isSaved = _React$useState2[0],\n      setisSaved = _React$useState2[1];\n\n  var _React$useState3 = React.useState(isSaved ? 1 : 0),\n      _React$useState4 = _slicedToArray(_React$useState3, 2),\n      productStar = _React$useState4[0],\n      setproductStar = _React$useState4[1];\n\n  var _React$useState5 = React.useState(false),\n      _React$useState6 = _slicedToArray(_React$useState5, 2),\n      snackbar = _React$useState6[0],\n      setsnackbar = _React$useState6[1];\n\n  var _React$useState7 = React.useState(\"\"),\n      _React$useState8 = _slicedToArray(_React$useState7, 2),\n      snackbarMsg = _React$useState8[0],\n      setsnackbarMsg = _React$useState8[1];\n\n  var _React$useState9 = React.useState(\"success\"),\n      _React$useState10 = _slicedToArray(_React$useState9, 2),\n      snackbarType = _React$useState10[0],\n      setsnackbarType = _React$useState10[1];\n\n  var userdetail = useSelector(function (state) {\n    return state.auth_user.user;\n  });\n  var accessToken = useSelector(function (state) {\n    return state.auth_user.accessToken;\n  });\n  var user = useSelector(function (state) {\n    return state.auth_user.user.id;\n  });\n  var userFavProducts = useSelector(function (state) {\n    return state.auth_user.userFavProducts;\n  });\n  useEffect(function () {\n    isFavourite();\n  }, [userFavProducts]);\n  var classes = useStyles();\n  var router = useRouter();\n  var favPage = router.pathname.search(\"favourite\") == -1 ? false : true;\n\n  var changeRating = function changeRating() {\n    if (!accessToken || accessToken == \"\") {\n      window.location.replace(\"/?signup=open\");\n    }\n\n    if (!isSaved && productStar == 0) {\n      Favourite({\n        type_id: data.id,\n        type: \"product\",\n        user_id: user,\n        action: \"add\"\n      }).then(function (response) {\n        if (response.error) {\n          setsnackbar(true);\n          setsnackbarMsg(\"There is some error.Please try again later\");\n          setsnackbarType(\"error\");\n          console.log(response.error);\n        } else {\n          setsnackbar(true);\n          setsnackbarMsg(\"Added to favourites\");\n          setsnackbarType(\"success\");\n          console.log(userdetail, accessToken, response);\n          dispatch(authenticated(userdetail, accessToken, response.body.favEvents, response.body.favProducts));\n        }\n      });\n      setproductStar(1);\n      setisSaved(!isSaved);\n    } else {\n      Favourite({\n        type_id: data.id,\n        type: \"product\",\n        user_id: user,\n        action: \"remove\"\n      }).then(function (response) {\n        console.log(response);\n\n        if (response.error) {\n          setsnackbar(true);\n          setsnackbarMsg(\"There is some error.Please try again later\");\n          setsnackbarType(\"error\");\n          console.log(response.error);\n        } else {\n          setsnackbar(true);\n          setsnackbarMsg(\"Removed from favourites\");\n          setsnackbarType(\"success\");\n          dispatch(authenticated(userdetail, accessToken, response.body.favEvents, response.body.favProducts));\n\n          if (favPage) {\n            document.getElementById(\"card_\" + data.id).parentElement.remove();\n          }\n        }\n      });\n      setproductStar(0);\n      setisSaved(!isSaved);\n    }\n  };\n\n  var _React$useState11 = React.useState(null),\n      _React$useState12 = _slicedToArray(_React$useState11, 2),\n      anchorEl = _React$useState12[0],\n      setAnchorEl = _React$useState12[1];\n\n  var handleClick = function handleClick(event) {\n    setAnchorEl(event.currentTarget);\n  };\n\n  var handleClose = function handleClose() {\n    setAnchorEl(null);\n  };\n\n  var handleEdit = function handleEdit() {\n    router.push(\"/post/edit/\" + data.id);\n  };\n\n  var handleDelete = function handleDelete() {\n    DeleteProduct(data, data.id).then(function (response) {\n      if (response.error) {\n        setsnackbar(true);\n        setsnackbarMsg(\"There is some error.Please try again later\");\n        setsnackbarType(\"error\");\n      } else {\n        setsnackbar(true);\n        setsnackbarMsg(\"Deleted\");\n        setsnackbarType(\"success\");\n        location.reload();\n      }\n    });\n  };\n\n  var isFavourite = function isFavourite() {\n    if (userFavProducts && userFavProducts.includes(data.id)) {\n      console.log(userFavProducts, userFavProducts.includes(data.id));\n      setisSaved(true);\n      setproductStar(1);\n    }\n  };\n\n  var handlesnackbar = function handlesnackbar() {\n    setsnackbar(!snackbar);\n  };\n\n  return __jsx(Card, {\n    id: 'card_' + data.id,\n    className: isSaved ? \"\".concat(classes.card, \" \").concat(classes.Orangecard, \" \") : \"\".concat(classes.card)\n  }, __jsx(CardContent, {\n    className: classes.cardInner\n  }, __jsx(\"div\", {\n    className: classes.cardHead\n  }, __jsx(Snackbar, {\n    open: snackbar,\n    autoHideDuration: 6000,\n    onClose: handlesnackbar\n  }, __jsx(Alert, {\n    onClose: handlesnackbar,\n    severity: snackbarType\n  }, snackbarMsg)), __jsx(Typography, {\n    variant: \"h6\",\n    className: classes.title\n  }, data.title.length >= 25 && __jsx(Link, {\n    href: \"/products/item/\".concat(data.id)\n  }, data.title.substring(0, 25) + '...', ' '), data.title.length < 25 && __jsx(Link, {\n    href: \"/products/item/\".concat(data.id)\n  }, data.title)), isAuthUser && __jsx(\"div\", null, __jsx(MoreVertIcon, {\n    \"aria-controls\": \"simple-menu\",\n    \"aria-haspopup\": \"true\",\n    onClick: handleClick\n  }), __jsx(Menu, {\n    id: \"simple-menu\",\n    anchorEl: anchorEl,\n    keepMounted: true,\n    open: Boolean(anchorEl),\n    onClose: handleClose\n  }, __jsx(MenuItem, {\n    onClick: handleEdit\n  }, \"Edit\"), __jsx(MenuItem, {\n    onClick: handleDelete\n  }, \"Delete\"))), !isAuthUser && isSaved ? __jsx(FavoriteIcon, {\n    style: {\n      color: 'var(--theme)'\n    },\n    onClick: changeRating,\n    id: data.id\n  }) : __jsx(FavoriteBorderIcon, {\n    style: {\n      color: 'var(--theme)'\n    },\n    onClick: changeRating,\n    id: data.id\n  })), __jsx(\"div\", {\n    className: classes.cardBody\n  }, data.images.length > 0 && __jsx(Link, {\n    href: \"/products/item/\".concat(data.id)\n  }, __jsx(\"img\", {\n    src: \"\".concat(API_HOST, \"/generate-thumb/145/300/\").concat(data.images[0].absolute_path),\n    alt: \"\",\n    className: classes.image\n  }))), __jsx(\"div\", {\n    className: classes.cardFooter\n  }, __jsx(\"div\", {\n    className: classes.left\n  }, __jsx(Typography, {\n    className: classes.excerpt\n  }, data.description.substring(0, 35) + '...', ' '), data.university.name.length >= 25 && __jsx(Typography, {\n    className: classes.college\n  }, data.university.name.substring(0, 25) + '...', ' '), data.university.name.length < 25 && __jsx(Typography, {\n    className: classes.college\n  }, data.university.name)), __jsx(\"div\", {\n    className: classes.right\n  }, __jsx(Typography, {\n    className: isSaved ? \"\".concat(classes.price, \" \").concat(classes.Orangeprice, \" \") : \"\".concat(classes.price)\n  }, \"\\u20B9\", data.price), __jsx(Typography, {\n    className: classes.date\n  }, moment(data.created_at).format('MMMM D '))))));\n}\n\nexport default ProductCard;","map":null,"metadata":{},"sourceType":"module"}