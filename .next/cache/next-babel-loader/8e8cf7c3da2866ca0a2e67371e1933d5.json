{"ast":null,"code":"import 'firebase/messaging';\nimport firebase from 'firebase/app';\nimport localforage from 'localforage';\nimport { updateDeviceToken } from '../src/apis/auth-api';\nconst firebaseCloudMessaging = {\n  tokenInlocalforage: async () => {\n    return localforage.getItem('fcm_token');\n  },\n  userInlocalforage: async () => {\n    return localforage.getItem('fcm_token_user');\n  },\n  init: async function (props) {\n    let data = {\n      apiKey: process.env.FIREBASE_API_KEY,\n      projectId: process.env.projectId,\n      messagingSenderId: process.env.messagingSenderId,\n      appId: process.env.appId\n    };\n\n    if (!firebase.apps.length) {\n      firebase.initializeApp(data);\n    }\n\n    try {\n      let user = await this.userInlocalforage();\n\n      if (user && user.id == props.id) {\n        const tokenInLocalForage = await this.tokenInlocalforage();\n\n        if (tokenInLocalForage !== null) {\n          return tokenInLocalForage;\n        }\n      }\n\n      const messaging = firebase.messaging();\n      await messaging.requestPermission(); // console.log('isSupported', messaging.isSupported())\n\n      const token = await messaging.getToken();\n      updateDeviceToken(props.id, token);\n      localforage.setItem('fcm_token', token);\n      localforage.setItem('fcm_token_user', props);\n      console.log('fcm_token', token);\n      return token;\n    } catch (error) {\n      console.log('fcmerror', error);\n    }\n  }\n};\nexport { firebaseCloudMessaging };","map":null,"metadata":{},"sourceType":"module"}