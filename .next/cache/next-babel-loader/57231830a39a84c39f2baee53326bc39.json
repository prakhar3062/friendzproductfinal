{"ast":null,"code":"var __jsx = React.createElement;\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React, { useState, useEffect } from \"react\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport Layout from \"../Layout\";\nimport { Box, Card, CardContent, TextField, Button, Container, Grid, Typography } from \"@material-ui/core\";\nimport { DropzoneDialog } from \"material-ui-dropzone\";\nimport LocalOfferIcon from \"@material-ui/icons/LocalOffer\";\nimport SubtitlesIcon from \"@material-ui/icons/Subtitles\";\nimport DetailsIcon from \"@material-ui/icons/Details\";\nimport SchoolIcon from \"@material-ui/icons/School\";\nimport Autocomplete from \"@material-ui/lab/Autocomplete\";\nimport Backdrop from \"@material-ui/core/Backdrop\";\nimport CircularProgress from \"@material-ui/core/CircularProgress\";\nimport { searchUniversities, searchCategories } from \"../apis/global-api\";\nimport { AddProduct, UpdateProduct } from \"../apis/auth-api\";\nimport CategoryIcon from \"@material-ui/icons/Category\";\nimport PhotoCameraOutlinedIcon from \"@material-ui/icons/PhotoCameraOutlined\";\nimport InputLabel from \"@material-ui/core/InputLabel\";\nimport MenuItem from \"@material-ui/core/MenuItem\";\nimport FormHelperText from \"@material-ui/core/FormHelperText\";\nimport FormControl from \"@material-ui/core/FormControl\";\nimport Select from \"@material-ui/core/Select\";\nimport { useDispatch } from \"react-redux\";\nimport { authenticated } from \"../redux/actions/auth\";\nimport { useRouter } from \"next/router\";\nimport { fileToBase64 } from \"../Utils/helpers\";\nimport DeleteIcon from \"@material-ui/icons/Delete\";\nconst useStyles = makeStyles(theme => ({\n  section: {\n    padding: \"5rem 0\",\n    position: \"relative\",\n    overflow: \"hidden\"\n  },\n  form: {\n    display: \"flex\",\n    flexWrap: \"wrap\"\n  },\n  pdTitle: {\n    marginBottom: \"2rem\"\n  },\n  card: {\n    boxShadow: \"none\",\n    border: \"#ccc solid 1px\",\n    height: \"100%\",\n    background: \"rgba(255, 255, 255, 0.6)\",\n    \"&::before\": {\n      content: '\"\"',\n      background: \"url(/static/images/circleCenter.svg)\",\n      backgroundRepeat: \"no-repeat\",\n      backgroundSize: \"cover\",\n      top: \"55%\",\n      left: \"50%\",\n      transform: \"translate(-50%, -50%)\",\n      height: \"540px\",\n      width: \"540px\",\n      position: \"absolute\",\n      zIndex: \"-1\"\n    },\n    \"&::after\": {\n      content: '\"\"',\n      background: \"url(/static/images/circleCenter.svg)\",\n      backgroundRepeat: \"no-repeat\",\n      backgroundSize: \"cover\",\n      bottom: \"-15rem\",\n      left: \"-25rem\",\n      height: \"50rem\",\n      width: \"50rem\",\n      position: \"absolute\",\n      zIndex: \"-1\"\n    }\n  },\n  cardBody: {\n    padding: \"2rem !important\"\n  },\n  formInput: {\n    marginBottom: \"2rem\",\n    width: \"50%\",\n    [theme.breakpoints.down(\"sm\")]: {\n      width: \"100%\",\n      marginBottom: \"1rem\"\n    }\n  },\n  formInputFullWidth: {\n    width: \"100%\"\n  },\n  formInputField: {\n    width: \"80%\",\n    \"& .MuiTextField-root\": {\n      width: \"100%\"\n    }\n  },\n  formInputFieldFull: {\n    [theme.breakpoints.up(\"sm\")]: {\n      width: \"90%\",\n      \"& .MuiTextField-root\": {\n        width: \"100%\"\n      },\n      \"& textarea\": {\n        width: \"100%\",\n        border: \"none\",\n        borderBottom: \"solid 1px #ccc\",\n        height: \"100px\"\n      },\n      \"& textarea:focus\": {\n        outline: \"none\",\n        borderBottom: \"solid 1px var(--theme)\"\n      }\n    }\n  },\n  formControl: {\n    width: \"100%\"\n  },\n  Button: {\n    width: \"80%\",\n    height: \"50px\",\n    marginTop: \"1rem\",\n    backgroundColor: \"var(--theme)\",\n    color: \"#fff\",\n    fontSize: \"1rem\",\n    boxShadow: \"none\",\n    maxWidth: \"200px\"\n  },\n  Images: {\n    display: \"flex\",\n    flexWrap: \"wrap\",\n    \"& img\": {\n      width: \"125px\",\n      height: \"125px\",\n      objectFit: \"contain\",\n      marginRight: \"10px\",\n      marginBottom: \"10px\",\n      border: \"solid 1px #333 \"\n    },\n    \"& video\": {\n      width: \"125px\",\n      height: \"125px\",\n      objectFit: \"contain\",\n      marginRight: \"10px\",\n      marginBottom: \"10px\",\n      border: \"solid 1px #333 \"\n    }\n  },\n  AddBtn: {\n    border: \"solid 1px #333\",\n    width: \"125px\",\n    height: \"125px\",\n    display: \"grid\"\n  },\n  dialogeCustom: {\n    \"& .MuiGrid-spacing-xs-8\": {\n      width: \"100%\",\n      margin: \"0\"\n    }\n  }\n}));\nexport default function Post({\n  user,\n  formtype = \"add\",\n  product = {}\n}) {\n  const classes = useStyles();\n  const {\n    0: open,\n    1: setOpen\n  } = useState(false);\n  const {\n    0: files,\n    1: setfiles\n  } = useState([]);\n  const {\n    0: filesInfo,\n    1: setfilesInfo\n  } = useState([]);\n  const {\n    0: title,\n    1: settitle\n  } = useState(product.title);\n  const {\n    0: type,\n    1: settype\n  } = useState(product.type);\n  const {\n    0: description,\n    1: setdescription\n  } = useState(product.description);\n  const {\n    0: price,\n    1: setprice\n  } = useState(product.price);\n  const {\n    0: university,\n    1: setuniversity\n  } = useState({\n    name: product.university ? product.university.name : \"\",\n    id: product.university ? product.university.id : \"\"\n  });\n  const {\n    0: category,\n    1: setcategory\n  } = useState({\n    name: product.category ? product.category.name : \"\",\n    id: product.category ? product.category.id : \"\"\n  });\n  const {\n    0: errs,\n    1: seterrs\n  } = useState({});\n  const {\n    0: universities,\n    1: setuniversities\n  } = useState(product.university ? [{\n    name: product.university.name,\n    id: product.university.id\n  }] : []);\n  const {\n    0: categories,\n    1: setcategories\n  } = useState(product.category ? [{\n    name: product.category.name,\n    id: product.category.id\n  }] : []);\n  const {\n    0: loading,\n    1: setloading\n  } = useState(false);\n  const {\n    0: loadingUni,\n    1: setloadingUni\n  } = useState(false);\n  const {\n    0: backdrop,\n    1: setbackdrop\n  } = useState(false);\n  const {\n    0: time_period,\n    1: settime_period\n  } = useState(product.time_period);\n  const {\n    0: formerrs,\n    1: setformerrs\n  } = useState([]);\n  const dispatch = useDispatch();\n  const router = useRouter();\n  useEffect(() => {\n    if (product.images) {\n      let updatedImages = [];\n      let updatedImagesInfo = [];\n      product.images.map((fileData, index) => {\n        updatedImages = updatedImages.concat(fileData.base64_data);\n        updatedImagesInfo = updatedImagesInfo.concat({\n          type: fileData.type,\n          data: fileData.link\n        });\n\n        if (index + 1 == product.images.length) {\n          setfiles(updatedImages);\n          setfilesInfo(updatedImagesInfo);\n        }\n      });\n    }\n  }, [product]);\n\n  const handleClose = () => {\n    setOpen(false);\n  };\n\n  const handleSave = filesArr => {\n    console.log(filesArr);\n    let count = 0;\n    let testARr = [];\n    filesArr.map((file, index) => {\n      count++;\n      const reader = new FileReader();\n      let filesArr = files;\n      let filesInfoArr = filesInfo;\n\n      reader.onload = event => {\n        console.log(\"testfile\", index, filesArr, filesArr); //store result into your state array.\n\n        filesArr[index] = event.target.result;\n        filesInfoArr[index] = {\n          type: file[\"type\"].split(\"/\")[0],\n          data: event.target.result\n        }; // let updatedImages = ();\n        // let updatedImagesInfo = ();\n\n        setfiles(filesArr);\n        setfilesInfo(filesInfoArr);\n\n        if (count == filesArr.length) {\n          setOpen(false);\n        }\n      };\n\n      reader.readAsDataURL(file);\n    });\n  };\n\n  const handleOpen = () => {\n    setOpen(true);\n  };\n\n  const updateformData = (e, type) => {\n    e.preventDefault();\n    eval(\"set\" + type + \"('\" + e.target.value + \"')\");\n  };\n\n  const handleUniSearch = e => {\n    let value = e ? e.target.value : \"\";\n    if (!value) return;\n    setloadingUni(true);\n    searchUniversities(value).then(response => {\n      setloadingUni(false);\n      setuniversities(response);\n    });\n  };\n\n  const handleCatSearch = e => {\n    let value = e ? e.target.value : \"\";\n    if (!value) return;\n    setloading(true);\n    searchCategories(value).then(response => {\n      setloading(false);\n      setcategories(response.data);\n    });\n  };\n\n  const checkValidation = () => {\n    setformerrs(\"\");\n\n    if (!title || !description || !price || !university.name || !category.name || !type) {\n      setformerrs([\"All fields are required\"]);\n      return false;\n    }\n\n    if (!files.length) {\n      setformerrs([\"Images are required\"]);\n      return false;\n    }\n\n    return true;\n  };\n\n  const handleSubmit = (e, uploaded_files) => {\n    e && e.preventDefault(); // console.log(files,filesInfo)\n    // return\n\n    let is_valid = checkValidation();\n\n    if (!is_valid) {\n      return;\n    }\n\n    setbackdrop(true);\n    let university_id = universities.find(item => item.name == university.name);\n    let category_id = categories.find(item => item.name == category.name);\n    let data = {\n      title: title,\n      description: description,\n      price: price,\n      university_id: university_id.id,\n      category_id: category_id.id,\n      seller_id: user.id,\n      type: type,\n      files: files,\n      active: true,\n      time_period: time_period\n    };\n\n    if (formtype == \"edit\" && product.id) {\n      UpdateProduct(data, product.id).then(response => {\n        if (response.error) {\n          setbackdrop(false);\n          setformerrs(response.msg);\n        } else {\n          router.push(\"/profile\");\n        }\n      });\n    } else {\n      AddProduct(data).then(response => {\n        if (response.error) {\n          setbackdrop(false);\n          setformerrs(response.msg);\n        } else {\n          router.push(\"/profile\");\n        }\n      });\n    }\n  };\n\n  const removeImage = index => {\n    let filterFiles = files.filter(function (file, i) {\n      return i !== index;\n    });\n    let filterFilesInfo = filesInfo.filter(function (file, i) {\n      return i !== index;\n    });\n    setfilesInfo(filterFilesInfo);\n    setfiles(filterFiles);\n  };\n\n  return __jsx(Layout, null, __jsx(\"section\", {\n    className: classes.section\n  }, backdrop && __jsx(Backdrop, {\n    className: classes.backdrop,\n    open: backdrop // onClick={handleClose}\n\n  }, __jsx(CircularProgress, {\n    color: \"inherit\"\n  })), __jsx(Container, {\n    maxWidth: \"xl\"\n  }, __jsx(Grid, {\n    container: true\n  }, __jsx(Grid, {\n    item: true,\n    lg: 9,\n    md: 9,\n    sm: 8,\n    xs: 12,\n    style: {\n      margin: \"auto\"\n    }\n  }, __jsx(Card, {\n    className: classes.card\n  }, __jsx(CardContent, {\n    className: classes.cardBody\n  }, __jsx(Typography, {\n    variant: \"h4\",\n    style: {\n      marginBottom: \"1rem\"\n    }\n  }, formtype == \"add\" ? \"Add\" : \"Edit\", \" Item  Details\"), __jsx(\"form\", {\n    className: classes.form,\n    noValidate: true,\n    autoComplete: \"off\",\n    onSubmit: handleSubmit\n  }, __jsx(\"div\", {\n    className: classes.formInput\n  }, __jsx(Grid, {\n    container: true,\n    spacing: 1,\n    alignItems: \"flex-end\"\n  }, __jsx(Grid, {\n    item: true\n  }, __jsx(SubtitlesIcon, null)), __jsx(Grid, {\n    item: true,\n    className: classes.formInputField\n  }, __jsx(TextField, {\n    id: \"fname\",\n    label: \"Title\",\n    value: title,\n    onChange: e => updateformData(e, \"title\")\n  })))), __jsx(\"div\", {\n    className: classes.formInput\n  }, __jsx(Grid, {\n    container: true,\n    spacing: 1,\n    alignItems: \"flex-end\"\n  }, __jsx(Grid, {\n    item: true\n  }, __jsx(LocalOfferIcon, null)), __jsx(Grid, {\n    item: true,\n    className: classes.formInputField\n  }, __jsx(TextField, {\n    id: \"lname\",\n    label: \"Price\",\n    value: price,\n    type: \"number\",\n    onChange: e => updateformData(e, \"price\")\n  })))), __jsx(\"div\", {\n    className: classes.formInput\n  }, __jsx(Grid, {\n    container: true,\n    spacing: 1,\n    alignItems: \"flex-end\"\n  }, __jsx(Grid, {\n    item: true\n  }, __jsx(CategoryIcon, null)), __jsx(Grid, {\n    item: true,\n    className: classes.formInputField\n  }, __jsx(Autocomplete, {\n    required: true,\n    options: categories,\n    getOptionLabel: option => {\n      return option.name;\n    },\n    getOptionSelected: (option, value) => option.name === value.name,\n    loading: loading,\n    value: category,\n    onInputChange: handleCatSearch // onChange={(e) => updateformData(e, \"university\")}\n    ,\n    onSelect: e => setcategory({\n      name: e.target.value\n    }),\n    renderInput: params => __jsx(TextField, _extends({}, params, {\n      label: \"Search Categories\",\n      InputProps: _objectSpread(_objectSpread({}, params.InputProps), {}, {\n        endAdornment: __jsx(React.Fragment, null, loading ? __jsx(CircularProgress, {\n          color: \"primary\",\n          size: 20\n        }) : null, params.InputProps.endAdornment)\n      })\n    }))\n  }), errs[\"category\"] && __jsx(Typography, {\n    color: \"error\"\n  }, \"Please select a category.\")))), __jsx(\"div\", {\n    className: classes.formInput\n  }, __jsx(Grid, {\n    container: true,\n    spacing: 1,\n    alignItems: \"flex-end\"\n  }, __jsx(Grid, {\n    item: true\n  }, __jsx(SchoolIcon, null)), __jsx(Grid, {\n    item: true,\n    className: classes.formInputField\n  }, __jsx(Autocomplete, {\n    required: true,\n    options: universities,\n    getOptionLabel: option => {\n      return option.name;\n    },\n    getOptionSelected: (option, value) => option.name === value.name,\n    loading: loadingUni,\n    value: university,\n    onInputChange: handleUniSearch // onChange={(e) => updateformData(e, \"university\")}\n    ,\n    onSelect: e => setuniversity({\n      name: e.target.value\n    }),\n    renderInput: params => __jsx(TextField, _extends({}, params, {\n      label: \"Search College\",\n      InputProps: _objectSpread(_objectSpread({}, params.InputProps), {}, {\n        endAdornment: __jsx(React.Fragment, null, loadingUni ? __jsx(CircularProgress, {\n          color: \"primary\",\n          size: 20\n        }) : null, params.InputProps.endAdornment)\n      })\n    }))\n  }), errs[\"university\"] && __jsx(Typography, {\n    color: \"error\"\n  }, \"Please select a university.\")))), __jsx(\"div\", {\n    className: `${classes.formInput}`\n  }, __jsx(Grid, {\n    container: true,\n    spacing: 1,\n    alignItems: \"flex-end\"\n  }, __jsx(Grid, {\n    item: true\n  }, __jsx(DetailsIcon, null)), __jsx(Grid, {\n    item: true,\n    className: `${classes.formInputField} `\n  }, __jsx(FormControl, {\n    className: classes.formControl\n  }, __jsx(InputLabel, {\n    id: \"demo-simple-select-label\"\n  }, \"type\"), __jsx(Select, {\n    labelId: \"demo-simple-select-label\",\n    id: \"demo-simple-select\",\n    value: type,\n    onChange: e => updateformData(e, \"type\")\n  }, __jsx(MenuItem, {\n    value: \"Buy\"\n  }, \"Buy\"), __jsx(MenuItem, {\n    value: \"Rental\"\n  }, \"Rental\")))))), type == \"Rental\" && __jsx(\"div\", {\n    className: `${classes.formInput}`\n  }, __jsx(Grid, {\n    container: true,\n    spacing: 1,\n    alignItems: \"flex-end\"\n  }, __jsx(Grid, {\n    item: true\n  }, __jsx(DetailsIcon, null)), __jsx(Grid, {\n    item: true,\n    className: `${classes.formInputField} `\n  }, __jsx(FormControl, {\n    className: classes.formControl\n  }, __jsx(InputLabel, {\n    id: \"demo-simple-select-label\"\n  }, \"Time Period\"), __jsx(Select, {\n    labelId: \"demo-simple-select-label\",\n    id: \"demo-simple-select\",\n    value: time_period,\n    onChange: e => updateformData(e, \"time_period\")\n  }, __jsx(MenuItem, {\n    value: \"day\"\n  }, \"Day\"), __jsx(MenuItem, {\n    value: \"week\"\n  }, \"Week\"), __jsx(MenuItem, {\n    value: \"month\"\n  }, \"Month\"), __jsx(MenuItem, {\n    value: \"year\"\n  }, \"Year\")))))), __jsx(\"div\", {\n    className: `${classes.formInput} ${classes.formInputFullWidth}`\n  }, __jsx(Grid, {\n    container: true,\n    spacing: 1,\n    alignItems: \"flex-end\"\n  }, __jsx(Grid, {\n    item: true\n  }, __jsx(DetailsIcon, null)), __jsx(Grid, {\n    item: true,\n    className: `${classes.formInputField} ${classes.formInputFieldFull}`\n  }, __jsx(\"textarea\", {\n    id: \"about\",\n    label: \"Description\",\n    value: description,\n    placeholder: \"Description\",\n    onChange: e => updateformData(e, \"description\")\n  })))), __jsx(\"div\", {\n    className: `${classes.formInput} ${classes.formInputFullWidth} `\n  }, __jsx(Typography, {\n    variant: \"h6\",\n    style: {\n      marginBottom: \"1rem\"\n    }\n  }, formtype == \"add\" ? \"Add\" : \"Edit\", \" Media\"), __jsx(\"div\", {\n    className: classes.Images\n  }, filesInfo.length > 0 && filesInfo.map((file, index) => __jsx(\"div\", null, file.type == \"image\" && __jsx(\"img\", {\n    src: file.data\n  }), file.type == \"video\" && __jsx(\"video\", {\n    src: file.data,\n    controls: true\n  }), __jsx(DeleteIcon, {\n    onClick: () => removeImage(index)\n  })) // <ProductMedia\n  //   file={file}\n  //   key={`img${index}`}\n  //   index={index}\n  //   removeFile={() => removeImage(index)}\n  // />\n  // <img src={file.data} key={`img${index}`} />\n  ), __jsx(Button, {\n    onClick: handleOpen.bind(this),\n    className: classes.AddBtn\n  }, __jsx(PhotoCameraOutlinedIcon, null), \"More+\")), __jsx(DropzoneDialog, {\n    filesLimit: 10,\n    open: open,\n    onSave: handleSave.bind(this),\n    acceptedFiles: [\"image/*\", \"video/*\"],\n    showPreviews: true,\n    maxFileSize: 50000000,\n    onClose: handleClose.bind(this),\n    className: \"dialogeCustom\"\n  })), __jsx(Button, {\n    type: \"submit\",\n    variant: \"contained\",\n    className: classes.Button\n  }, formtype == \"add\" ? \"Add\" : \"Edit\", \" Item\")), formerrs.length > 0 && formerrs.map((msg, index) => __jsx(Typography, {\n    color: \"error\",\n    key: `error${index}`\n  }, msg)))))))));\n}","map":null,"metadata":{},"sourceType":"module"}